"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const yjs_1 = require("yjs");
class YDocHandler {
    constructor(docName, docOptions = { gc: true }) {
        this.feedOptions = {
            valueEncoding: "binary",
        };
        this.kind = docName;
        this.doc = new yjs_1.Doc(docOptions);
        this.doc.on("update", (update, origin) => {
            const isFeedOrigin = typeof origin === "string" && origin.length === 64;
            if (!isFeedOrigin) {
                // console.log("local update", update);
                this.defaultFeed.append(Buffer.from(update));
            }
        });
    }
    handleMessage(feed, msg) {
        // console.log("remote update", msg, feed.key);
        yjs_1.applyUpdate(this.doc, msg, feed.key);
    }
}
exports.default = YDocHandler;
