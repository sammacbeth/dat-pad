var test = require('tape')
var random = require('../')('testing-' + Math.random(), { size: 1000 })
var balloc = require('buffer-alloc')

test.skip('race condition checker', function (t) {
  t.plan(10 + 10*2)
  var cool = random('cool.txt', { size: 1000 })
  var pending = 10
  var ops = []
  for (var i = 0; i < 1000; i += 100) (function (i) {
    ops.push(function () {
      cool.write(i, balloc(100).fill(String(i)), cb)
    })
  })(i)
  ops.sort(function (a,b) { return Math.random() > 0.5 ? -1 : +1 })
  function cb (err) {
    t.ifError(err)
    if (--pending !== 0) return
    for (var i = 0; i < 1000; i += 100) (function (i) {
      cool.read(i, 100, function (err, buf) {
        t.ifError(err)
        t.equal(buf.toString(), balloc(100).fill(String(i)).toString())
      })
    })(i)
  }
})
